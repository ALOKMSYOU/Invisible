-- FE Bring GUI by ChatAbc (ปรับแล้วให้เข้ากับ HACK GUI และขยับสูงขึ้น 2 หน่วย) | ใช้สคริปต์นี้เท่านั้น

local plrs = game:GetService("Players")
local lp = plrs.LocalPlayer
local ws = game:GetService("Workspace")
local uis = game:GetService("UserInputService")
local cam = ws.CurrentCamera

local angles = CFrame.Angles
local cf = CFrame.new
local v3 = Vector3.new
local v3_010 = v3(0,1,0)
local v3_0 = v3(0,0,0)
local twait = task.wait
local osclock = os.clock
local slower = string.lower

-- ความเร็ว
local speeding = 6 -- เริ่มต้น
local maxspeed = 65
local off = angles(-math.pi/2, 0, 0)

-- utils
local function gp(p,n,cl)
	for _,v in ipairs(p:GetChildren()) do
		if v.Name==n and v:IsA(cl) then
			return v
		end
	end
	return nil
end

local function rs(len)
	local s = ""
	for i = 1, len or math.random(8,15) do
		s = s .. string.char(math.random(65, 90))
	end
	return s
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = rs()
gui.ResetOnSpawn = false
gui.Parent = lp:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 260) -- ขยายสูงขึ้นนิดนึงเผื่อ dropdown
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BorderSizePixel = 0
frame.Parent = gui

-- จัดให้อยู่กลางจอ แต่เลื่อนขึ้น 2 หน่วย (≈ 40 พิกเซล)
local function centerFrame()
	local size = cam.ViewportSize
	frame.Position = UDim2.new(0, size.X/2 - frame.AbsoluteSize.X/2, 0, size.Y/2 - frame.AbsoluteSize.Y/2 - 40)
end
centerFrame()
cam:GetPropertyChangedSignal("ViewportSize"):Connect(centerFrame)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "FE Bring GUI"
title.TextColor3 = Color3.fromRGB(200,200,200)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.Parent = frame

-- ซ่อนช่องกรอกข้อความเดิมไว้ แต่ยังไม่ลบ
local input = Instance.new("TextBox")
input.PlaceholderText = "DisplayName / Name (ไม่ต้องใช้)"
input.Size = UDim2.new(1, -20, 0, 30)
input.Position = UDim2.new(0, 10, 0, 40)
input.BackgroundColor3 = Color3.fromRGB(50,50,50)
input.BorderSizePixel = 0
input.TextColor3 = Color3.new(1,1,1)
input.TextSize = 18
input.Text = ""
input.Visible = false -- ซ่อนไว้
input.Parent = frame

-- Dropdown Button
local dropdownBtn = Instance.new("TextButton")
dropdownBtn.Size = UDim2.new(1, -20, 0, 30)
dropdownBtn.Position = UDim2.new(0, 10, 0, 40) -- แทนที่ input ที่ซ่อน
dropdownBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
dropdownBtn.BorderSizePixel = 0
dropdownBtn.TextColor3 = Color3.new(1,1,1)
dropdownBtn.TextSize = 18
dropdownBtn.Font = Enum.Font.SourceSansBold
dropdownBtn.Text = "เลือกผู้เล่น"
dropdownBtn.Parent = frame

local dropdownFrame = Instance.new("ScrollingFrame")
dropdownFrame.Size = UDim2.new(1, -20, 0, 120)
dropdownFrame.Position = UDim2.new(0, 10, 0, 70)
dropdownFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
dropdownFrame.BorderSizePixel = 0
dropdownFrame.Visible = false
dropdownFrame.CanvasSize = UDim2.new(0,0,0,0)
dropdownFrame.Parent = frame
dropdownFrame.ScrollBarThickness = 6

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = dropdownFrame

-- ปุ่ม Bring
local bringBtn = Instance.new("TextButton")
bringBtn.Text = "BRING"
bringBtn.Size = UDim2.new(1, -20, 0, 30)
bringBtn.Position = UDim2.new(0, 10, 0, 200)
bringBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
bringBtn.TextColor3 = Color3.new(1,1,1)
bringBtn.Font = Enum.Font.SourceSansBold
bringBtn.TextSize = 18
bringBtn.Parent = frame

-- ความเร็ว (Speed Display)
local speedLbl = Instance.new("TextLabel")
speedLbl.Size = UDim2.new(1, -20, 0, 20)
speedLbl.Position = UDim2.new(0, 10, 0, 235)
speedLbl.BackgroundTransparency = 1
speedLbl.Text = "Speed: " .. speeding
speedLbl.TextColor3 = Color3.new(1, 1, 1)
speedLbl.Font = Enum.Font.SourceSans
speedLbl.TextSize = 16
speedLbl.Parent = frame

-- ปุ่ม + และ -
local plusBtn = Instance.new("TextButton")
plusBtn.Size = UDim2.new(0, 30, 0, 25)
plusBtn.Position = UDim2.new(1, -90, 0, 260)
plusBtn.Text = "+"
plusBtn.BackgroundColor3 = Color3.fromRGB(0,200,0)
plusBtn.TextColor3 = Color3.new(1,1,1)
plusBtn.Font = Enum.Font.SourceSansBold
plusBtn.TextSize = 18
plusBtn.Parent = frame

local minusBtn = Instance.new("TextButton")
minusBtn.Size = UDim2.new(0, 30, 0, 25)
minusBtn.Position = UDim2.new(1, -130, 0, 260)
minusBtn.Text = "-"
minusBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
minusBtn.TextColor3 = Color3.new(1,1,1)
minusBtn.Font = Enum.Font.SourceSansBold
minusBtn.TextSize = 18
minusBtn.Parent = frame

-- ปรับความเร็ว
plusBtn.MouseButton1Click:Connect(function()
	if speeding < maxspeed then
		speeding += 1
		speedLbl.Text = "Speed: " .. speeding
	end
end)

minusBtn.MouseButton1Click:Connect(function()
	if speeding > 1 then
		speeding -= 1
		speedLbl.Text = "Speed: " .. speeding
	end
end)

-- ปุ่มกลับ
local backBtn = Instance.new("TextButton")
backBtn.Text = "BACK"
backBtn.Size = UDim2.new(0, 80, 0, 25)
backBtn.Position = UDim2.new(0, 10, 1, -35)
backBtn.BackgroundColor3 = Color3.fromRGB(30, 100, 150)
backBtn.TextColor3 = Color3.new(1,1,1)
backBtn.Font = Enum.Font.SourceSansBold
backBtn.TextSize = 14
backBtn.Parent = frame

backBtn.MouseButton1Click:Connect(function()
	local main = lp:FindFirstChild("PlayerGui"):FindFirstChild("HACKGUI")
	if main then
		local mainFrame = main:FindFirstChildWhichIsA("Frame")
		if mainFrame then
			mainFrame.Visible = true
		end
	end
	gui:Destroy()
end)

local destroyBtn = Instance.new("TextButton")
destroyBtn.Text = "DESTROY"
destroyBtn.Size = UDim2.new(0, 80, 0, 25)
destroyBtn.Position = UDim2.new(1, -90, 1, -35)
destroyBtn.BackgroundColor3 = Color3.fromRGB(100, 30, 30)
destroyBtn.TextColor3 = Color3.new(1,1,1)
destroyBtn.Font = Enum.Font.SourceSansBold
destroyBtn.TextSize = 14
destroyBtn.Parent = frame

destroyBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)

local statusLbl = Instance.new("TextLabel")
statusLbl.Text = "by ChatAbc"
statusLbl.BackgroundTransparency = 1
statusLbl.Position = UDim2.new(1, -5, 1, -5)
statusLbl.AnchorPoint = Vector2.new(1,1)
statusLbl.TextColor3 = Color3.fromRGB(150,150,150)
statusLbl.TextSize = 14
statusLbl.Font = Enum.Font.SourceSans
statusLbl.Parent = frame

-- Draggable
local function Draggable(f)
	local dragging, start, pos
	local function update(input)
		local delta = input.Position - start
		f.Position = UDim2.new(pos.X.Scale, pos.X.Offset + delta.X, pos.Y.Scale, pos.Y.Offset + delta.Y)
	end
	f.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			start = input.Position
			pos = f.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	f.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			update(input)
		end
	end)
end
Draggable(frame)

-- ระบบค้นหาและกำหนด target เดิม

local others = {}
for _,v in pairs(plrs:GetPlayers()) do
	if v ~= lp then others[v] = true end
end
plrs.PlayerAdded:Connect(function(p) others[p] = true end)
plrs.PlayerRemoving:Connect(function(p) others[p] = nil end)

local function findplr(txt)
	if txt == "" then return nil end
	for v in pairs(others) do
		if v.DisplayName == txt or v.Name == txt then return v end
	end
	for v in pairs(others) do
		if slower(v.DisplayName) == slower(txt) or slower(v.Name) == slower(txt) then return v end
	end
	return nil
end

local target = nil

input:GetPropertyChangedSignal("Text"):Connect(function()
	target = findplr(input.Text)
	if target then
		bringBtn.TextColor3 = Color3.fromRGB(80,255,80)
	else
		bringBtn.TextColor3 = Color3.fromRGB(255,255,255)
	end
end)

-- เมื่อกด dropdown ให้แสดงรายชื่อผู้เล่น
dropdownBtn.MouseButton1Click:Connect(function()
	dropdownFrame.Visible = not dropdownFrame.Visible
end)

-- สร้างรายการชื่อผู้เล่นใน dropdownFrame
local function refreshDropdown()
	for _, child in pairs(dropdownFrame:GetChildren()) do
		if not child:IsA("UIListLayout") then
			child:Destroy()
		end
	end
	
	local count = 0
	for _, p in pairs(plrs:GetPlayers()) do
		if p ~= lp then
			count = count + 1
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, 0, 0, 20)
			btn.Position = UDim2.new(0, 0, 0, (count-1)*20)
			btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
			btn.BorderSizePixel = 0
			btn.Font = Enum.Font.SourceSans
			btn.TextSize = 14
			btn.TextColor3 = Color3.new(1,1,1)
			btn.Text = p.Name
			btn.Parent = dropdownFrame

			btn.MouseButton1Click:Connect(function()
				target = p
				dropdownBtn.Text = "▶ " .. p.Name
				dropdownFrame.Visible = false
				bringBtn.TextColor3 = Color3.fromRGB(80,255,80)
			end)
		end
	end
	
	-- อัพเดตความสูง ScrollFrame
	dropdownFrame.CanvasSize = UDim2.new(0, 0, 0, count * 20)
end

refreshDropdown()

plrs.PlayerAdded:Connect(refreshDropdown)
plrs.PlayerRemoving:Connect(refreshDropdown)

-- ฟังก์ชันดึง (ไม่แก้ไขจากเดิม)
local bringing = false
local notifyId = 0
local function notify(msg)
	notifyId += 1
	local id = notifyId
	statusLbl.Text = msg
	twait(2)
	if notifyId == id then statusLbl.Text = "by ChatAbc" end
end

bringBtn.MouseButton1Click:Connect(function()
	if bringing then bringing = false bringBtn.Text = "BRING" return end
	if not target then return end

	local c, c1 = lp.Character, target.Character
	if not (c and c1) then return notify("no character") end
	if not (c:IsDescendantOf(ws) and c1:IsDescendantOf(ws)) then return notify("not in workspace") end

	local hrp, hrp1 = gp(c,"HumanoidRootPart","BasePart"), gp(c1,"HumanoidRootPart","BasePart")
	if not (hrp and hrp1) then return notify("no HRP") end

	bringing = true
	bringBtn.Text = "BRINGING..."

	local fromP, toP = hrp1.Position, hrp.Position
	local mag = (fromP - toP).Magnitude - 3
	local lv = cf(fromP,toP).LookVector
	local vel = 0
	local pos = fromP - v3_010*2

	local torso = gp(c1, "UpperTorso", "BasePart") or gp(c1, "Torso", "BasePart")
	if torso then
		toP = torso.Position
	else
		toP = toP - v3_010 * 2
	end

	local sine = osclock()
	local lastsine = sine
	local way = 0
	local reachedmax = false

	while bringing and c:IsDescendantOf(ws) and c1:IsDescendantOf(ws) do
		sine = osclock()
		local delta = sine - lastsine
		lastsine = sine

		if reachedmax then
			if mag - way < reachedmax then
				vel -= delta * speeding
				if vel < 0 then break end
			end
		else
			if way > mag / 2 then
				vel -= delta * speeding
				if vel < 0 then break end
			else
				vel += delta * speeding
				if vel > maxspeed then
					reachedmax = way
					vel = maxspeed
				end
			end
		end

		way += vel * delta
		if not hrp:IsGrounded() then
			hrp.CFrame = cf(pos + lv*way, toP) * off
			hrp.Velocity = lv * (vel + 1)
			hrp.RotVelocity = v3_0
		end
		twait()
	end

	hrp.CFrame = cf(toP)
	hrp.Velocity = v3_0
	hrp.RotVelocity = v3_0
	bringBtn.Text = "BRING"
	bringing = false
end)
